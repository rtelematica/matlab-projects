%% Filtro IIR forma directa II en paralelo

b =[-0.003783810074016  -0.009046661941983   0
     0.002181990154299   0.030387399742593   0
     0.016289497941491  -0.053146761666721   0
    -0.048306332033846   0.070981107827838   0 
     0.090223618353717  -0.082557367996389   0
    -0.137349451232475   0.087456263524376   0
     0.181568746078250  -0.085348138238321   0
    -0.209638957657794   0.076074486075259   0
     0.204501430107163  -0.060016236557258   0
    -0.152728526723648   0.038395716977289   0
     0.057042015366863  -0.013202856923529   0
     7.294421000000000e-009              0   0 ];


a = [1.000000000000000   0.000866681856803   0.990771280831018
     1.000000000000000   0.041240328258604   0.972200679556789
     1.000000000000000   0.122341660853422   0.952894333844869
     1.000000000000000   0.245493203130189   0.932210430483890
     1.000000000000000   0.411988405074767   0.909630477837414
     1.000000000000000   0.621249454872566   0.884895040406446
     1.000000000000000   0.867751910412265   0.858253182103121
     1.000000000000000   1.136720450932629   0.830825060947546
     1.000000000000000   1.400021463305091   0.804951083326149
     1.000000000000000   1.616192572630439   0.784181121727422
     1.000000000000000   1.739758280747222   0.772450778411654
     1.000000000000000                   0                   0];


kf = 7.294421000000000e-009;

Nf = length(b(:,1));
Nc = 3;

%señal de entrada
x = [1 2 3 4];

%Inicializamos variables
a1 = 0;
a2 = 0;

v(1:Nf,1:Nc) = 0;

y = 0;

v_temp = 0;

%Forma Directa 2
for n = 1 : length(x)
    
    acu = 0;
    
    for numF = 1 : Nf
    
        a1 = 0;
        a2 = 0;

        for j = 2 : Nc
            a1 = a1 + a(numF,j) * v(numF,j-1);
        end

        for k = Nc : -1 : 2
            v(numF,k) = v(numF,k-1);
        end

        v(numF,1) = x(n) - a1;

        for k = 1 : Nc
            a2 = a2 + b(numF,k)*v(numF,k);
        end

        acu = acu + a2;
                
    end
    
    y(n) = acu;   
    
end

%Filter

acuF = 0;


for numF = 1 : Nf
    acuF = acuF + filter(b(numF,:),a(numF,:),x);
        
end           
    
y

acuF

yy = filter(B,A,x)

