%k=0.566021489270347;   

%  b = [  0  0.161739794072636   0.331038270584070  
%         0   -0.053946557976740   0.118485560966040   
%         0   0.316523429050713    0   
%         k   0         0         ];
    
%  b = [    0.161739794072636   0.331038270584070     0
%           -0.053946557976740   0.118485560966040   0 
%           0.316523429050713    0                   0
%           k                   0         0         ];    
%  
%  a = [  1.000000000000000   0.772602670388958   0.581311843017032
%        1.000000000000000   0.182678773815096   0.861143014079740
%         1.000000000000000   0.639535044143855   0
%         1.000000000000000                   0       0];
%    

close all;clc;clear all;
%format long

%B=[0.566021489270347   1.327017068994198   2.050848045521379   2.050848045521379   1.327017068994198   0.566021489270347];
%A=[1.000000000000000   1.594816488347912   2.194528926158545   1.784277924092865   0.994003337574404   0.320146531398122];

A = [ 1.0000    1.5948    2.1945    1.7843    0.9940    0.3201 ];
B = [ 0.5660    1.3270    2.0508    2.0508    1.3270    0.5660 ];

[r,p,k]= residue(B,A);

j=1;
for i=1:2:length(r)-1
    
    [bp,ap]=residue([r(i),r(i+1)],[p(i),p(i+1)],0);
    if(length(bp)<3)
        bp(3)=bp(2);
        bp(2)=bp(1);
        bp(1)=0;
    end
    b(j,:)=bp
    a(j,:)=ap
    j=j+1;
    %%Hasta aqui s?lo hemos a?adido h1 y h2
end
[tamr,tamc]=size(b);
b(tamr+1,:)=[0 r(length(r)) 0];
a(tamr+1,:)=[1 -p(length(p)) 0];
b(tamr+2,:)=[k 0 0];
a(tamr+2,:)=[1 0 0];

a 
b

x = [1:10];

N=2;
Nr=4;

y=0;
v=0;
s1=0;
s2=0;
fil=0;
acu=0;

for i = 1 : Nr
    for j = 1 : N + 1
        v(i,j)=0;
    end
end


for n = 1 : length(x)

    acu=0;
    
   for  fil=1:Nr
       
         s1=0;
         s2=0;
       
       for j = 2 :  N+1 
               s1 = s1 + a(fil,j) *v(fil,j-1);        
       end

       for  k = N+1 : -1 : 2 
            v(fil,k) = v(fil,k-1);
        end                        

        v(fil,1) =  x(n) - s1;

        for k = 1 : N+1              
              s2 = s2 + b(fil,k) * v(fil,k);                        
        end    

        acu = acu + s2;
  
   end  
   y(n)=real(acu)
 
    
end


a1=[   1.000000000000000   1.594816488347912   2.194528926158545   1.784277924092865 0.994003337574404   0.320146531398122];
b1=[   0.566021489270347   1.327017068994198   2.050848045521379   2.050848045521379 1.327017068994198   0.566021489270347];

	
filtro = filter(b1,a1,x)
 